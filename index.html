<script src="/static/js/jquery.min.js"></script>
<style>
    .bt-w-menu{width: 140px;}
    .bt-w-con{margin-left: 140px;}
    .bt-select,
    .dns-select{
        width: 400px;
        height: 35px;
        line-height: 35px;
        border: 1px solid #ccc;
        border-radius: 2px;
        position: relative;
    }
    .bt-select .bt-select-tips,
    .dns-select .dns-select-tips{
        color: #999;
    }
    .bt-select .bt-select-list,
    .dns-select .dns-select-list{
        display: none;
        position: absolute;
        z-index: 999;
        max-height: 220px;
        overflow-y: auto;
        width: 100%;
        top: 33px;
        left: 0;
        background: #fff;
        border: 1px solid #ccc;
    }
    .bt-select .bt-select-list.active,
    .dns-select .dns-select-list.active{
        display: block;
    }
    .bt-select .bt-select-list li,
    .dns-select .dns-select-list li{
        padding:  2px 10px;
        cursor: pointer;
    }
    .bt-select .bt-select-list li.active,
    .dns-select .dns-select-list li.active{
        background: #efefef;
    }
    .bt-select .bt-select-list li:hover,
    .dns-select .dns-select-list li:hover{
        background: #efefef;
    }
    .bt-select-input,
    .dns-select-input{
        position: relative;
        cursor: pointer;
        padding-left: 10px;
    }
    .max_box_view{
        display: none;
    }

    .bt-down-icon,
    .dns-down-icon{
        position: absolute;
        top: 10px;
        right: 10px;
        width: 10px;
        height: 10px;
        border-left:2px solid #666;
        border-bottom:2px solid #666;
        transform: rotate(-45deg);
        transition: all 500ms;
    }
    /*.addanalysisFrom .line{*/
    /*    margin-bottom: 16px;*/

    /*}*/
    .addanalysisFrom .line .tname{
        height: 35px;
        line-height: 35px;
    }
    .addanalysisFrom .line input{
        height: 35px;
        line-height: 35px;
        padding-left: 10px;
    }
    .layui-layer-page .layui-layer-content{
        overflow: initial;
    }
    .word_width .bt-select-tips{
        width: 310px;
        display: inline-block;
        text-overflow: ellipsis;
        overflow: hidden;
        white-space: nowrap;
        vertical-align: middle;
    }
    #soa_orm .line .info-r{
        margin-bottom: 10px;
    }
    #soa_orm .line .info-r .bt-input-text{
        width: 200px;
    }
    .bt-ico-ask{
        border: 1px solid #fb7d00;
        border-radius: 8px;
        color: #fb7d00;
        cursor: help;
        display: inline-block;
        font-family: arial;
        font-size: 11px;
        font-style: normal;
        height: 16px;
        line-height: 16px;
        margin-left: 5px;
        text-align: center;
        width: 16px;
    }
</style>
<div class="bt-form">
    <div class="bt-w-main">
        <div class="bt-w-menu">
            <p class="bgw">Domain name list</p>
            <p>Defualt NS</p>
            <p>Service</p>
            <p>Logs</p>
        </div>
        <div class="bt-w-con pd15 divtable">
            <div class="bt-box active">
                <div class="mb10">
                    <a class="btn btn-success btn-sm va0 mb15 addDomain" href="/site/php" style="margin-right: 10px">Add domain name</a>
                </div>
                <div class="table-box">
                	<div class="tbThead">
                		<table class="table table-hover">
	                    	<thead>
                                <tr>
                                    <th>Domain</th>
                                    <th style="text-align: right">Operating</th>
                                </tr>
                            </thead>
		                </table>
                	</div>
                	<div class="tbTbody" style="max-height: 330px;overflow: auto;">
                		<table class="table table-hover">
		                    <tbody id="domainList">
                                
                            </tbody>
		                </table>
                    </div>
                </div>
            </div>
            <div></div>
            <div class="bt-box" style="display: none;">
                <div class="soft-man-con bt-form dnsServer">
                    <div class="bt-form">
                    <div class="line">
                        <span class="tname">NameServer 1</span>
                        <div class="info-r c4"><input class="bt-input-text" type="text" name="ns_default_val" placeholder="Your Name Server,eg: ns1.aapanel.com,Optional" autocomplete="off" value="" style="width:270px"></div>
                        <span class="tname">NameServer 2</span>
                        <div class="info-r c4"><input class="bt-input-text" type="text" name="ns_default_val2" placeholder="Your Name Server,eg: ns2.aapanel.com,Optional" autocomplete="off" value="" style="width:270px"></div>
                        <span class="tname"></span>
                        <div class="info-r c4">
                        </div>
                    </div>
                    <div class="sfm-opt">
                        <button class="btn btn-default btn-sm" style="display:block;" id="saveDefaultNsFn">Save</button>
                    </div>
                </div>
                </div>
            </div>
            <div class="bt-box" style="display: none;">
                <div class="soft-man-con bt-form dnsServer">
                    <p class="status">Statusï¼š<span>Running</span>
                        <span style="color: #20a53a; margin-left: 3px;" class="glyphicon glyphicon glyphicon-play"></span>
                    </p>
                    <div class="sfm-opt">
                        <button class="btn btn-default btn-sm StartDnsServer" style="display: none;">Start</button>
                        <button class="btn btn-default btn-sm StopDnsServer" style="display: none;">Stop</button>
                        <button class="btn btn-default btn-sm RestartDnsServer">Restart</button>
                    </div>
                </div>
            </div>
            <div class="bt-box" style="display: none;">
                <button class="btn btn-success btn-sm va0 pull-right mb15 clearLogs" disabled="disabled">Clean up logs</button>
                <table width="100%" border="0" cellpadding="0" cellspacing="0" class="table table-hover">
                    <thead><tr><th>Details</th><th>Operating time</th></tr></thead>
                    <tbody id="logsBody"></tbody>
                </table>
                <div id="logsBodyPage" class="page"></div>
            </div>
        </div>
    </div>
</div>
<script>
    function getWebsites() {
        $.post('/aapanel_varnish/get_websites.json', function(data) {
            let sites = data.msg;
            let html = "";
            sites.forEach(site => {
                let varnishStatus = site.varnish_status ? "Enabled" : "Disabled";
                let statusColor = site.varnish_status ? "red" : "green";
                let actionText = site.varnish_status ? "Disable" : "Enable";
                let actionFunc = site.varnish_status ? "disableCache" : "enableCache";
                let purgeLink = site.varnish_status ? `<a class="btlink purge-cache" href="javascript:;" onclick="purgeCache('${site.name}')" style="color: orange;">Purge</a>` : '';
                let divider = site.varnish_status ? `<div role="separator" class="n-divider __divider-1cpbmap n-divider--vertical n-divider--no-title mx-4px!"></div>` : '';

                html += `<tr>
                    <td>${site.name}</td>	                        
                    <td style="text-align:right">	                            
                        <a class="btlink" style="color:${statusColor}" onclick="${actionFunc}('${site.name}')">${actionText}</a>
                        ${divider}
                        ${purgeLink}
                    </td>	                    
                </tr>`;
            });
            $('#domainList').html(html);
        });
    }

    function enableCache(domain) {
        $.post('/aapanel_varnish/enable_cache.json', { domain }, function(data) {
            alert(data.msg);
            getWebsites(); // Reload site list
        });
    }

    function disableCache(domain) {
        $.post('/aapanel_varnish/disable_cache.json', { domain }, function(data) {
            alert(data.msg);
            getWebsites(); // Reload site list
        });
    }

    function purgeCache(domain) {
        $.post('/aapanel_varnish/purge_cache.json', { domain }, function(data) {
            alert(data.msg);
            getWebsites(); // Reload site list
        });
    }

    getWebsites();
</script>
